{"componentChunkName":"component---src-templates-post-template-jsx","path":"/works/posts/2021-02-22--001","result":{"data":{"site":{"siteMetadata":{"title":"Blog by Eunyoung","subtitle":"EY's 개발 히스토리 블로그","copyright":"© All rights reserved.","author":{"name":"EunYoung","twitter":"#"},"disqusShortname":"","url":"https://eunyoung-autocrypt.github.io"}},"markdownRemark":{"id":"da23a1c7-c754-5d14-89d8-4319a46114e4","html":"<br>\n<p>이번에 다른 부서에서 사온 제품 2개에 대한 설치 매뉴얼 검토중에 작업 단순화가 필요하다고 느꼈다.<br>\n이에 불필요한 작업 제거 및 설치 단순화를 하여 설치 스크립트를 생성하는 목적으로 이 작업을 진행하여 되었다.<br>\n이 작업을 진행하면서 배운 내용이나 기록이 필요한 내용을 정리한다.  </p>\n<p><span class=\"title__sub1\">■ 1. 수작업 최소화</span>\n<span class=\"title__sub2\">1.1. Cloud, On-Premise 둘다 OS는 데비안 계열을 사용</span></p>\n<ul>\n<li>Ubuntu 18.04 에서 진행</li>\n</ul>\n<p><span class=\"title__sub2\">1.2. 두 제품에 대한 리펙토링을 진행하기 전까지 JAVA8, Tomcat8 사용</span>\ntomcat major 버전이 fix 이므로 8버전의 latest 파일을 받아 아래 파일들을 수정한다.</p>\n<ul>\n<li><b>1.2.1. context.xml</b><br>\n— datasource 설정  </li>\n<li><b>1.2.2. server.xml</b><br>\n— 최대 2개의 WAS 서비스를 사용하므로 <span class=\"text-mark__green\"> port 를 동적으로 설정</span>  </li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/3d14480d82b7fb44b2423b96a57fe1a5/29492/001-01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 522px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 28.750000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABJ0AAASdAHeZh94AAABAklEQVQY002RUXLDIAxEc5zGgAABBgL+6PT+Z9pKSp3px1oGSW9W4sGZELxHjAkheIToLXrvEMh/RERgZuScQZEQcxAREpPkPI7jgHMOj5+LsWfGWi+080TtDD4jcokoPcs5I6aAlBLmnKbMAhVgkppco5j5B1w94XsLsBOu/ULvHVyzFVpxert1/rCm4IO5DYHgbRIvOWfS/IPkcoojBZ/Fo9WKMSaKQOsoKI1xjoZyyrkVrGthzAEuLA7JXOroCjeg2nw+D9OXKMue9t4G1bjWwr62wdRxfWXbqXMH/F+vgj4j6+eWXuquxhho7bSoD6EPoDCSXUZ+u0ryz6IbdPf/Atb8u6otFOWnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 01\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/3d14480d82b7fb44b2423b96a57fe1a5/29492/001-01.png\"\n        srcset=\"/devHistoryBlog/static/3d14480d82b7fb44b2423b96a57fe1a5/8ff5a/001-01.png 240w,\n/devHistoryBlog/static/3d14480d82b7fb44b2423b96a57fe1a5/e85cb/001-01.png 480w,\n/devHistoryBlog/static/3d14480d82b7fb44b2423b96a57fe1a5/29492/001-01.png 522w\"\n        sizes=\"(max-width: 522px) 100vw, 522px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li><b>1.2.3. catalina.sh</b><br>\n— <span class=\"text-mark__green\">java system properties 설정</span><br>\n— http 포트가 8080 일 경우,<br>\n — 8005 -> ${port.shutdown}<br>\n — 8009 -> ${port.ajp}<br>\n — 8443 -> ${port.https} 가 된다.  </li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/a463a5f1f2799ad66ea082705e23a975/dc333/001-02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 938px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 17.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABJ0AAASdAHeZh94AAAAzElEQVQY01WQS2rEQAxEfZPMZNruj1rqVvsXGwIhIYts5v63qZGdIZDFoyRKFIW61ATMEYWTQZAcQSJwonBsnu2SA6r5kg27yRTO+bgvnOG54CYNrozoZF9BWjBM7+jHDUUbxlqhOiKWGYNucOaFUhGOIPJIqUeIDvGkhzcdTA86/foEzQsu+x0v6zfavGOfFuMNH1QhZcNl+8HVPGfhVRiULMBf/+GfdLxOSIXPFk4XsDWZVTEdVIPsDbUhW+ue4tkihNtvSHj9Y3jyAAFlecY8Ry56AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 02\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/a463a5f1f2799ad66ea082705e23a975/dc333/001-02.png\"\n        srcset=\"/devHistoryBlog/static/a463a5f1f2799ad66ea082705e23a975/8ff5a/001-02.png 240w,\n/devHistoryBlog/static/a463a5f1f2799ad66ea082705e23a975/e85cb/001-02.png 480w,\n/devHistoryBlog/static/a463a5f1f2799ad66ea082705e23a975/dc333/001-02.png 938w\"\n        sizes=\"(max-width: 938px) 100vw, 938px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p><span class=\"title__sub1\">■ 2. Service 등록</span>\n<span class=\"title__sub2\">2.1. 서비스파일 생성</span></p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">[Unit]\nDescription=WCA WAS\nRequires=mysqld.service\nAfter=network.target mysqld.service\n\n[Service]\nType=forking\nEnvironment=WCA_LIB=/opt/penta/wca-libs\nEnvironment=SERVICE_PORT=8080\nEnvironment=CATALINA_HOME=/opt/tomcat-wca\nEnvironment=JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64\nEnvironment=LD_LIBRARY_PATH=/opt/penta/wca-libs:$LD_LIBRARY_PATH\n\nUser=autocrypt\nGroup=autocrypt\n\nExecStart=/opt/tomcat-wca/bin/startup.sh\nExecStop=/opt/tomcat-wca/bin/shutdown.sh\n\nRestart=always\n\n[Install]\nWantedBy=multi-user.target</code></pre></div>\n<ul>\n<li><b>Requires vs After</b><br>\n— <a href=\"https://stackoverflow.com/questions/40593242/systemd-using-both-after-and-requires\">https://stackoverflow.com/questions/40593242/systemd-using-both-after-and-requires</a></li>\n<li><b>Environment</b><br>\n— User를 설정하더라도 bash_profile이나 기타 <span class=\"text-mark__green\">쉘/유저 기반의 환경 변수는 먹지 않는다.</span><br>\n— 따라서 해당 프로퍼티를 사용하여 환경 변수를 설정한다.</li>\n<li><b>Restart</b><br>\n— 해당 서비스가 강제 종료되었을 경우 재시작에 대한 정책이다.<br>\n— systemctl 로 종료했을 경우는 작동하지 않는다.</li>\n<li><b>WantedBy</b><br>\n— [install] 은 “systemctl enable [service name]” 으로 서비스 등록 시 이용하는 섹션이다.<br>\n— WantedBy 는 이 서비스가 어떤 전제조건 하에서 실행되는 지를 결정한다.<br>\n— multi-user.target 은 runlevel 3 환경이 모두 구동되었을 때를 의미한다.<br>\n— <span class=\"text-mark__blue\">run leval (리눅스시스템의 실행레벨)</span><br>\n ▶ init 0 : halt, 시스템 종료<br>\n ▶ init 1 : Single user mode, 관리 모드로 root 계정만 사용 가능<br>\n ▶ init 2 : Multiuser, without NFS (The same as 3, if you do not have networking)<br>\n ▶ init 3 : Full multiuser mode, default level<br>\n ▶ init 4 : unused, 사용하지 않는 실행레벨, 커스텀레벨로 사용 가능<br>\n ▶ init 5 : X11, X윈도우 환경으로 실행된 멀티유저 실행모드<br>\n ▶ init 6 : reboot  </li>\n</ul>\n<p><span class=\"title__sub2\">2.2. 기타 설정 및 서비스 활성화 스크립트 생성</span></p>\n<ul>\n<li>각 Step 별로 블럭지어 실패 시 메시지 출력 및 종료하도록 구성</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/2a40559cff525bbf32826ed963af32c2/47730/001-03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 428px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 51.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABrklEQVQoz1VSUZajIBDMUTaJIggCCiGOmsRMZt/e/0S1BZrZnY9+1UBTVHVz8INEiBJd1yB4j8E52E7BW0PUjBadUXB7vtVYnmv0xN5pSHWGaE5o5BmHOWqkawuta0Tfs9jD2hbO23LBGU0yA8/I2PPBwJrBduit49qQaCMrhKY+oxZHvnBEa2r4geTVEZfTGYovx7GH66ksdkQNzzxj5xrEJKHaele3K2x4aZN8ZLHB8/OOKXT4MzmkD4tb6DGnAetzwf0x4/W6YV0XPNaJ64hppgsnC6kg6SEz56SiSus1Xl9PzPeE8R6Q2gapqjBNCcttxI2Ej3XGOF3Kw8t9wev3wvOIphBSYZCiWDBdDcU+WkfLpkGrGeKElpY6z8F0suxrDi+j4TrXWqdL/j2UJASJKvaiKn0QVJpRKhao87bX/CoteWNT4sTev/eP/4ai5PvSiT2UtOQRgkIaAj7iteAYUvlGF+aR3yYNER/hgpHn14w8z9+nJnEhfP+jgUTrp0dPi5r9y3ZzaC1+YA7131q1oqjLHIfQ1LS2+Zf7xOWu+tt6zt/4I7b2iD0yx19t9y+R+XkXXgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 03\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/2a40559cff525bbf32826ed963af32c2/47730/001-03.png\"\n        srcset=\"/devHistoryBlog/static/2a40559cff525bbf32826ed963af32c2/8ff5a/001-03.png 240w,\n/devHistoryBlog/static/2a40559cff525bbf32826ed963af32c2/47730/001-03.png 428w\"\n        sizes=\"(max-width: 428px) 100vw, 428px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>서비스 활성화 Step<br>\n— service 파일 활성화 명령어 : $ systemctl enable {service 파일명}<br>\n— daemon reload 명령어 : $ systemctl daemon-reload  </li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/5d8236538d4cabf795efc722db79b89f/242e2/001-04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 703px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABJ0AAASdAHeZh94AAABRElEQVQoz32R2XLDIAxF/SVNnGCz2GCzxOAt6UP//5duBU6mM5m2D2cEQrpoqbwTsLbDqA20Jms6SHVFw88Q/ATJP8Dp3PILmuaMpv2BNSewNpPPOaZGZboGQjGE0MH1HG4wCNbBGQPhIs7hATU6DEbAh5EYMFIB1vWIyZW79wrz0kN1DFUrLuBEnA0iBXk7YE0Ja0wY0w65fCHMK9Z1wn5fiJmSLQlphNsI5w2clZhS7owEubyWdtIcsGwRU3SURII73eeRsNj3G9YtIUZPONymI5mVEdQF1tRFp1KSlZaLIFXx+Fyxbbkag/vDkd+j1zQW+pg/u3mRfUJk8vnwVVa2kNR7dkgKkDInM7IHQrCS9C6WyUt4pxLPhykqGm7etobpJW1bY6CtG63Iqj8F331VT7+3oqa2WJnLEfQKrH9N+k/0G2C98NKyfbjzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 04\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/5d8236538d4cabf795efc722db79b89f/242e2/001-04.png\"\n        srcset=\"/devHistoryBlog/static/5d8236538d4cabf795efc722db79b89f/8ff5a/001-04.png 240w,\n/devHistoryBlog/static/5d8236538d4cabf795efc722db79b89f/e85cb/001-04.png 480w,\n/devHistoryBlog/static/5d8236538d4cabf795efc722db79b89f/242e2/001-04.png 703w\"\n        sizes=\"(max-width: 703px) 100vw, 703px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>스크립트 생성하면서 리눅스 파일 시스템 계층 구조에 맞게 설정 등의 디렉토리를 구성하였다.<br>\n▶ <a href=\"https://ko.wikipedia.org/wiki/%ED%8C%8C%EC%9D%BC%EC%8B%9C%EC%8A%A4%ED%85%9C_%EA%B3%84%EC%B8%B5%EA%B5%AC%EC%A1%B0_%ED%91%9C%EC%A4%80\">리눅스 파일 시스템 계층구조 표준 위키피디아</a></li>\n</ul>\n<br>\n<h4>github</h4>\n<ul>\n<li><a href=\"https://github.com/eunyoung-autocrypt/bash-scripts\">https://github.com/eunyoung-autocrypt/bash-scripts</a></li>\n</ul>","fields":{"tagSlugs":["/tags/systemd/","/tags/tomcat/"],"slug":"/works/posts/2021-02-22--001"},"frontmatter":{"title":"[작업로그] WCA, WVA 서비스 설치 스크립트 만들기","tags":["systemd","tomcat"],"date":"2021-02-22","description":""}}},"pageContext":{"slug":"/works/posts/2021-02-22--001"}},"staticQueryHashes":[]}