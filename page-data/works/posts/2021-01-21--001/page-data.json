{"componentChunkName":"component---src-templates-post-template-jsx","path":"/works/posts/2021-01-21--001","result":{"data":{"site":{"siteMetadata":{"title":"Blog by Eunyoung","subtitle":"일상 & 작업 기록 블로그","copyright":"© All rights reserved.","author":{"name":"EunYoung","twitter":"#"},"disqusShortname":"","url":"https://eunyoung-autocrypt.github.io"}},"markdownRemark":{"id":"0ee6a5d3-637a-522d-88cf-2b08e614200e","html":"<p><span class=\"title__sub1\">1. Jenkins Item 생성 (Pull Request)</span></p>\n<ul>\n<li>pipeline 선택\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/12a2bc787d353b4201c6980d1c078589/1e088/001-01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 840px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 73.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABJ0AAASdAHeZh94AAACSElEQVQ4y4WSy3LTMBSG/ZA8AU/AnhdgzYIlW3ZsWXSGRRlmyqVN04YmqZOW2E58le+SbGeSn3NkuwxDC575fHQk+5z/l2RJ3UA2LWrdQjIN05m8qBVKovgP4ze10rC2YYxPZ98wvVniy+QK3y+v8fViislsjjArEaQFMURRDPnf+CJHUlSwgjjB0l7BcT14Ox/edgeX4HEUC0SJgE9NA5EhogZPEVLRtKxhhSLFcrXG+qeDgAqIvESSFYY4zQ38jZ9k5qenYPWCFVbkO5Md8kr+QUbdRvo5iuVA9Qg0X9aSCpY5JuencDd3sG0b6/UanudBKWnQWkNJ2aOUQcqakL+pa0PbNrBUTZLtz4jDHba7HVYr2k/Hgee6pvDW22Kz2fRj2luH5nndpcjz7pDHcYyGboil2xap2iNJEgRBgLruVTFN00ATSiuTt5wP880wHum6jhRSQfZ9bd/RicamYEP3khdGe0rph5/lg+VhK5R6iIfDAfv9HhZX5ifLMiOfrfl+AEHXhVWHYWhi7yA01ngujmIjgr+Logh5nvcKG3pVkm57WaKqKgN35W7M8Xg03Rl+OH8MXu8t05WY3d5jcbvCbPYD0+kV5vM5losFJpNL053VMzwWQiBLU6M4IpWsmOGchViKXji2QFtC5xHZdpAXhbkyBUVmVM7j0QnHcd1AOe+1JXWJ1ycXePn+DK8+nCMsBLq2P0W2wIynOub/ggoWePHuFM/enOD524+4p/uYpb0dthGbjU+QDjZ7q1F/OBwH27wV3PQXBrVuAQAkcLkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 01\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/12a2bc787d353b4201c6980d1c078589/1e088/001-01.png\"\n        srcset=\"/devHistoryBlog/static/12a2bc787d353b4201c6980d1c078589/8ff5a/001-01.png 240w,\n/devHistoryBlog/static/12a2bc787d353b4201c6980d1c078589/e85cb/001-01.png 480w,\n/devHistoryBlog/static/12a2bc787d353b4201c6980d1c078589/1e088/001-01.png 840w\"\n        sizes=\"(max-width: 840px) 100vw, 840px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<br>\n<ul>\n<li>Build Trigger에서 generic Webhook Trigger를 선택한다.</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/b7aaf19c6c7610288e3e81807ee675ca/f8915/001-02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 748px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABT0lEQVQoz52S226DMBBE+f9PbAIYCGB7fcGoRYREmq6XkKYvVduH1RrZPjszpqiVwtD3qGuFeZ5xv99xvV6xbZv0dV3/VEXPsFxKNYgxYpompJSkL8vyH+BF1ClW2rYtrLXw3sM5JwcOpb+toutaVFWNpmmkiByMMQw2PKDDMAwCPuy/Xn79fipseoLRA7quw0Ws1/AhyGa2/JPtV9CxLjxb01rD0m6ViMRuVtZwDOX5hLqqJJLyfJZYyrKUwW+nfW8ctUQjwBAiIisKj/LeCXjiB+op4uISWhth4iyXbreblGQrGX+3X+SXdY/ccid+lFEbDAyzLmC0rNYQiNf5bB6ae5qinHn/WBj0ZbsIrMZa2m0zzDBMjRwDA7xj+zYPIqk89PlgAw8OaVctf8J6WA6sioHjCGusQDWrcpQ77eBHtke+lPdYtfe7WuPTU+EnDDX49SS/jysAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 02\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/b7aaf19c6c7610288e3e81807ee675ca/f8915/001-02.png\"\n        srcset=\"/devHistoryBlog/static/b7aaf19c6c7610288e3e81807ee675ca/8ff5a/001-02.png 240w,\n/devHistoryBlog/static/b7aaf19c6c7610288e3e81807ee675ca/e85cb/001-02.png 480w,\n/devHistoryBlog/static/b7aaf19c6c7610288e3e81807ee675ca/f8915/001-02.png 748w\"\n        sizes=\"(max-width: 748px) 100vw, 748px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p><span class=\"title__sub1\">2. webhook token 설정</span></p>\n<ul>\n<li>BitBucket 에서 설정했던 token 값을 넣는다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/22475/001-06.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 14.583333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABJ0AAASdAHeZh94AAAAZ0lEQVQI15WOSQrAIBRDvf8dFRGcikNF96mxA5SuunjkJ5BPRCkFrTX03n8xxni4fYwRwhgD5xxSSouc84szz5+cZe89QgjY5s1R1loIKRWUUtBar8cM7VQuJ7XWB/r9Uj68YY8LmR//TuJjPxbLEwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 06\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/d9199/001-06.png\"\n        srcset=\"/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/8ff5a/001-06.png 240w,\n/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/e85cb/001-06.png 480w,\n/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/d9199/001-06.png 960w,\n/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/22475/001-06.png 1039w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<p><span class=\"title__sub1\">3. Parameters 정의</span></p>\n<ul>\n<li>request payload 에서 사용할 값들을 정의한다.</li>\n<li>bitbucket webhook 에 대한 각 이벤트 request payload는 <a href=\"https://support.atlassian.com/bitbucket-cloud/docs/event-payloads/\">여기</a> 에서 볼 수 있다. 근데.. 난 보기 불편하다.  </li>\n</ul>\n<p><span class=\"title__sub2\">3.1. parameter catch 방법 선택</span> </p>\n<ul>\n<li>아래와 같이 paramters를 캐치할 수 있는 폼이 있는데, 해당 hook은 POST method 형식이므로 맨 첫번째를 선택한다.</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/1ac29/001-03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA4UlEQVQY02WN227EIAxE8/+/2K1akQZygYBtzC0vNWRXrbRHljHDjJmCmtf551Cz07oCNqSKeFcB6AP0ueGzX5HrftQYa2sTaGORMEYgBIoxpZgT55xKkeKSRaHEXU9ZPIEjW/cMe6XMx2N9fNqvb1g0aUPGRLPyuo1aRREddX8S86lUXJaaUg8jkXUOAHPOzJxYfs3phpNMUrWIs3O1S5BLHUwhhG3gvXfOSUdEkGWjjxNlz+0ug/piCgDbvp/eyxfttfKd/5m/MBGdpw8DGY7D7tsOITgnC/0t+uDF9h7+BdtGjixk8p3AAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 03\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/d9199/001-03.png\"\n        srcset=\"/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/8ff5a/001-03.png 240w,\n/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/e85cb/001-03.png 480w,\n/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/d9199/001-03.png 960w,\n/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/1ac29/001-03.png 1022w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<p><span class=\"title__sub2\">3.2. 사용할 변수들을 정의한다.</span> </p>\n<ul>\n<li>Variable : 변수로 사용할 이름  </li>\n<li>Expression : payload에서 사용 할 값  </li>\n<li>JSONPath : payload가 json으로 들어오므로 해당 값을 선택한다.</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/51ed8/001-04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 67.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABJ0AAASdAHeZh94AAABQUlEQVQ4y6VT2Y6DMAzM//9b/6KUQjlyQQK0mrWdBKHuqqrYh5GNwdeMUU3ToOs6DMOIGOMphDlAXy4IzkFZa/F6vbBtG5ZlOY3pekWcZyhHVY0x1GnBuq6nsQFUeIWq6zu46Nl1d4QgVk3ThJlG5ZX/NWGmTA3DIBOWwP7BmvxjLPEVP3Kp+r6XgiyOJS6ds+I/Rgttkj8Y5tki0Fqc9Gl1VVU3SfLeg9dnyzB+hvNEB8Ws5/gkCcep/5yQuwYhNNmQyY1hRiA7BTqJEMVnrgu46fGZwbmqulao6xp3QnWr0Tx6mthA6xGjNuho9U6n9fm8TLbMvdY6xxK4qGrbdhelqHXE80n48gJk5cIZ87iLI356NpnfrwtqbSSxFGbfZb+AxXpXs4jwS2VjnRAuP/nhLNg/Eh6zKOWd904avZ/SD+C7P6mdFfvJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 04\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/d9199/001-04.png\"\n        srcset=\"/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/8ff5a/001-04.png 240w,\n/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/e85cb/001-04.png 480w,\n/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/d9199/001-04.png 960w,\n/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/51ed8/001-04.png 1021w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<p><span class=\"title__sub2\">3.3. 정의한 변수들</span> </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. SOURCE_BRANCH  \n  -- PR 타켓 branch  \n  -- expression: $.pullrequest.source.branch.name\n\n2. COMMENT_URL\n  -- pipeline에서 정의한 stage 수행 시 comment 기록를 위한 url  \n  -- expression: $.pullrequest.links.comments.href\n\n3. DECLINE_URL\n  -- pipeline에서 정의한 stage 실패 시 PR decline을 위한 url  \n  -- expression: $.pullrequest.links.decline.href\n\n4. REPO_URL\n  -- git repository url \n  -- expression: $.pullrequest.destination.repository.links.html.href</code></pre></div>\n<p><span class=\"title__sub1\">4. Pipeline 작성</span></p>\n<ul>\n<li>맨 아래 pipeline을 작성하는 폼이 있다.</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/aa61c/001-07.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 27.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABJ0AAASdAHeZh94AAAAZ0lEQVQY062PWw6AIAwEe/+TEg2ItshTVssNRJtM9m8yJWMMSilIKf0COeeQc/6FWjLIWjvMWjlLrRWtNaxeQN77ITzPiBjfw8zQLzVssRtIzV+u9z7qlH5doG0/cLDMIwKW8GwYewOngtQk5YbheAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 07\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/d9199/001-07.png\"\n        srcset=\"/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/8ff5a/001-07.png 240w,\n/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/e85cb/001-07.png 480w,\n/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/d9199/001-07.png 960w,\n/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/aa61c/001-07.png 1065w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<ul>\n<li>아래와 같이 작성한다.</li>\n<li>예제는 Develop Branch PR 로 한다.</li>\n<li>그 외 3개 시나리오에 대해선 github에 정리하자.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">node {\n    withCredentials([usernameColonPassword(credentialsId: 'bitbucket-auth-id-pw', variable: 'USER')]) {\n        stage ('Clone') { //clone 타켓 branch  \n            try {\n                git branch: '$SOURCE_BRANCH', credentialsId: 'bitbucket-auth-id-pw', url: '$REPO_URL'\n            } catch(e) {\n                sh '''\n                    curl -X POST -u \"$USER\" $COMMENT_URL -d '{\"content\": {\"raw\": \"[CLONE] FAIL\"}}' -H 'Content-Type: application/json';\n                    curl -X POST -u \"$USER\" $DECLINE_URL -d '{\"content\": {\"raw\": \"[CLONE] FAIL\"}}' -H 'Content-Type: application/json';\n                    echo [CLONE] FAIL;\n                    exit 1;\n                '''\n            }\n        }\n        \n        stage ('Build') { //테스트 없이 소스코드 빌드 ( 컴파일 오류 체크 ), 실패 시 해당 PR comment 등록 및 decline\n            sh '''\n            {\n                echo [BUILD - BACKEND]\n                chmod +x ./gradlew\n                ./gradlew clean build -x test \\\n                &amp;&amp; curl -X POST -u \"$USER\" $COMMENT_URL -d '{\"content\": {\"raw\": \"[BUILD] SUCCESS\"}}' -H 'Content-Type: application/json' > /dev/null 2>&amp;1 \\\n                &amp;&amp; echo [BUILD] SUCCESS;\n            }||\\\n            {\n                curl -X POST -u \"$USER\" $COMMENT_URL -d '{\"content\": {\"raw\": \"[BUILD] FAIL\"}}' -H 'Content-Type: application/json';\n                curl -X POST -u \"$USER\" $DECLINE_URL -d '{\"content\": {\"raw\": \"[BUILD] FAIL\"}}' -H 'Content-Type: application/json';\n                echo [BUILD] FAIL;\n                exit 1;\n            }\n            '''\n        }\n    }\n}</code></pre></div>\n<hr>\n<p><a href=\"https://eunyoung-autocrypt.github.io/devHistoryBlog/works/posts/2021-01-18--001\">> [작업로그] CI/CD 구축 #1 - CI/CD 시나리오</a><br>\n<a href=\"https://eunyoung-autocrypt.github.io/devHistoryBlog/works/posts/2021-01-18--002\">> [작업로그] CI/CD 구축 #2 - Docker, Docker Compose 설치</a><br>\n<a href=\"https://eunyoung-autocrypt.github.io/devHistoryBlog/works/posts/2021-01-18--003\">> [작업로그] CI/CD 구축 #3 - BitBucket 설정 및 Jenkins 설치</a>  </p>\n<p><a href=\"https://eunyoung-autocrypt.github.io/devHistoryBlog/works/posts/2021-01-23--002\">> [작업로그] CI/CD 구축 #5 - sonarqube 설치 및 pipeline 작성</a>  </p>","fields":{"tagSlugs":["/tags/ci-cd/","/tags/jenkins/","/tags/pipeline/"],"slug":"/works/posts/2021-01-21--001"},"frontmatter":{"title":"[작업로그] CI/CD 구축 #4","tags":["ci/cd","jenkins","Pipeline"],"date":"2021-01-21","description":"Jenkins Item 등록 및 Pipeline 작성"}}},"pageContext":{"slug":"/works/posts/2021-01-21--001"}},"staticQueryHashes":[]}