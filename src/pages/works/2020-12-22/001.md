---
title: "[MariaDB] SlowQuery 설정 및 확인"
date: "2020-12-22"
layout: post
draft: false
path: "/works/posts/2020-12-22--001.md"
category: "works"
tags:
  - "slow query"
description: ""
---

### Slow Query(슬로우쿼리)
- Slow Query(슬로우쿼리)는 지정된 시간보다 실행하는데 오래걸리는 쿼리에 대한 log
- 특정 작업이 오래 걸린다면 로그를 통해 원인을 파악이 가능

<br>

### #1. 설정 방법
- my.cnf 파일 설정

```
# 3초 이상 소요된 쿼리 기록
[mysqld]
log_slow_queries       = /var/log/mysql/mysql-slow.log
long_query_time = 3
```

<br>

### #2. 설정 확인
- service restart 및 활성화 확인
```
$ /etc/init.d/mysqld restart

mysql> show variables like ‘slow_query_%’;
```

<br>

### #3. 로그파일
- 아래와 같은 형식으로 로그파일에 기록됨
```
# Query_time : 쿼리 처리시간  
# Lock_time : lock이 걸린 횟수  
# Row_sent : 조회 결과 Row 수  
# Rows_examined : 조회 대상 ROW 수  

# User@Host: DB_유저[DB_유저] @ server_hostname [서버IP]
# Query_time: 0.000599  Lock_time: 0.000163 Rows_sent: 3  Rows_examined: 86
SET timestamp=1489118717;
select count(*)
```

<br>

### #4. mysqladmin 명령어로 상태 출력
```
// -i5 : interval 5s
$ mysqladmin -i5 status -u root -p
Enter password: 
Uptime: 10578  Threads: 1  Questions: 4809  Slow queries: 589  Opens: 1321  Flush tables: 1  Open tables: 348  Queries per second avg: 0.454

# Uptime : MySQL server 시삭된 후 현재 시간 (초 단위)
# Threads : 현제 DB 서버에 연결된 유저수
# Questions : 서버 시작후 지금까지 요청된 쿼리수
# Slow queries : mysql 설정파일에 슬로우쿼리의 쿼리시간 이상을 가진 요청수
# Opens : 서버가 시작된 후 현재까지 열렸던 테이블수
# Open tables : 현재 열려 잇는 테이블 수
# Queries per second avg : 평균 초단 쿼리수
```
