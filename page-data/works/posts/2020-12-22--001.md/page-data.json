{"componentChunkName":"component---src-templates-post-template-jsx","path":"/works/posts/2020-12-22--001.md","result":{"data":{"site":{"siteMetadata":{"title":"Blog by Eunyoung","subtitle":"EY's 개발 히스토리 블로그","copyright":"© All rights reserved.","author":{"name":"EunYoung","twitter":"#"},"disqusShortname":"","url":"https://eunyoung-autocrypt.github.io"}},"markdownRemark":{"id":"4e3827e0-33dc-51ec-9cd5-3d210b0debfb","html":"<h3>Slow Query(슬로우쿼리)</h3>\n<ul>\n<li>Slow Query(슬로우쿼리)는 지정된 시간보다 실행하는데 오래걸리는 쿼리에 대한 log</li>\n<li>특정 작업이 오래 걸린다면 로그를 통해 원인을 파악이 가능</li>\n</ul>\n<br>\n<h3>#. 설정 확인</h3>\n<ul>\n<li>slow query log 설정 상태 확인</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># slow query 설정 정보\nmysql&gt; show global variables like &#39;slow%&#39;;</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/c9a4118eaae557a4491e4650e3480b65/e4c9a/001-01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 591px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 40.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABUklEQVQoz21R146DMBDMl1xJKCZ0bMCYFggp9/8fNLe7iaI7KQ+jlRcznrLbLgtu9zPWdcS8DLjeFri+Qedq9ENDaDGOLbTJMc8OJ7pj6kJ2eRHLme+Eag8VHbBrbQWGtRpNW8ERkalzVDqVvetr2E7LmfeMskqgdYaiTFA3BdJUCRmT7gwthtFi22ZRdqZZFEf5mNPkb6w+SUMcYx9xEryQEFGWRwjCbyEUhdpkpITVlaTEyGTikl5nBRUp4Z/TTL1BRHdiqKddISzJyvW2YrvMuP9csKyDqI2OHhRhotxUtMfB+4Dnfwr84DG94EseY8JQPS2zioUsMSFPtsjhs2rOqnMNxskSqJBTj4EK6J8Yp06y/WeZ22Srj/CNlMJtzycnLXNRbEsKoXi4DCZ5lFTQo+mrYSGsm1Jsdc5Idpaa5fOy9JiIlFtkuz7Ze4e/6hi/7Y/9N6x8EY8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 01\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/c9a4118eaae557a4491e4650e3480b65/e4c9a/001-01.png\"\n        srcset=\"/devHistoryBlog/static/c9a4118eaae557a4491e4650e3480b65/8ff5a/001-01.png 240w,\n/devHistoryBlog/static/c9a4118eaae557a4491e4650e3480b65/e85cb/001-01.png 480w,\n/devHistoryBlog/static/c9a4118eaae557a4491e4650e3480b65/e4c9a/001-01.png 591w\"\n        sizes=\"(max-width: 591px) 100vw, 591px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 소요시간 확인\nmysql&gt; show global variables like &#39;%long_query_time%&#39;;</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/e075030c0255aaa2bda14dffa54a6b21/2c288/001-02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 684px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAx0lEQVQY041QSRLCMAzLU1jblG5pS/bScIAD/P8/wnGnXOGgUaxYih0x3zyWJcAHjTg7Zu9XLCkSX1m7LR5XrfiszYDsi9HC2AmBOOuyOkGszY7CDJuMHcjYI90DGRXGqUXbVWhaibopiEtc6jNpEl1fcb3dyeoIkc1xtvSiY1g3olcXCoxwbmJTUe5xLnbMG3K9arvvXSkPEMPY0MiGQzWtFKKGUjVrr/eTVp6+zb+Q+0Q2phTovwJP+HgkRq7VUPNqW/M/oR8+XJwQ4N8RewAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 02\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/e075030c0255aaa2bda14dffa54a6b21/2c288/001-02.png\"\n        srcset=\"/devHistoryBlog/static/e075030c0255aaa2bda14dffa54a6b21/8ff5a/001-02.png 240w,\n/devHistoryBlog/static/e075030c0255aaa2bda14dffa54a6b21/e85cb/001-02.png 480w,\n/devHistoryBlog/static/e075030c0255aaa2bda14dffa54a6b21/2c288/001-02.png 684w\"\n        sizes=\"(max-width: 684px) 100vw, 684px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 로그파일 저장 방법 (FILE / TABLE)\nmysql&gt; show global variables like &#39;%log_output%&#39;;</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/ab24097d71c08c59a8d7996770dbbcb2/6114d/001-03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 623px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 30.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA30lEQVQY05VQSXLDMAzTU9q0ibzE8ardsuPk0P7/QwhJTzK9tT1gSEEYEKRa14TtlpGXiBAt1usM6wZ6B6TZ4UZ/xvaIyeG6ZTg/IiUr3LJGzKThyqjqI5QPE3L2mLMjQyPVul0ck0HX1yJsLoXg3GjUZy0c95e2FHBflB9Q/dCATTmNDyMZegzEsbmxHXRxwPH0hpN+f9WfYO7Js1aNU4sYJzFi8JS2q7FtMw2xKKvPl/g3sE7t9/KSkA0n02Gh+8kA4qp/GErC/eAGno9NiQKl/fq+ywBeWxe82uHPhg/IL7pdeTFsiQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 03\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/ab24097d71c08c59a8d7996770dbbcb2/6114d/001-03.png\"\n        srcset=\"/devHistoryBlog/static/ab24097d71c08c59a8d7996770dbbcb2/8ff5a/001-03.png 240w,\n/devHistoryBlog/static/ab24097d71c08c59a8d7996770dbbcb2/e85cb/001-03.png 480w,\n/devHistoryBlog/static/ab24097d71c08c59a8d7996770dbbcb2/6114d/001-03.png 623w\"\n        sizes=\"(max-width: 623px) 100vw, 623px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<h3>#. 설정 방법</h3>\n<h4>#1. my.cnf 파일 설정 및 재기동</h4>\n<ul>\n<li>파일 설정</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 3초 이상 소요된 쿼리를 테이블에 기록\n[mysqld]\nslow_query_log=1\nlong_query_time = 3\n\nlog_output = TABLE\nlog_slow_queries       = /var/log/mysql/mysql-slow.log</code></pre></div>\n<ul>\n<li>재기동</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ /etc/init.d/mysqld restart</code></pre></div>\n<br>\n<h4>#2. 쿼리문 사용 (편하다…, 재기동시 날라간다…)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 해당 값(초) 이상의 로그 기록\nmysql&gt; set global long_query_time = 3;\n\n# 슬로우쿼리 활성 여부 (0 = 비활성 / 1 = 활성)\nmysql&gt; set global slow_query_log = 1;\n\n# 로그파일 저장 방법 변경\nmysql&gt; set global log_output = &#39;TABLE&#39;;</code></pre></div>\n<br>\n<h3>#. 로그 확인</h3>\n<h4>#. mysql.slow_log 테이블 확인</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mysql&gt; select sleep(3);\n\nmysql&gt; select * from mysql.slow_log\\G</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/4aae148b1988ba271b336ed8e2299443/c7dcc/001-04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 641px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 65.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABoklEQVQ4y41T6XqCQAzkSWqrgigKyH3f3l/r+z/NNAlq69X6I+zCktnMZKJEsYc0DRDFLvxgCX63l3NZl86c9oacBaEDz7fgBbb8Fyc+jLkGVXuHNvm4hBJGLuo6Q1XnyItY9kWRoKpSFGWCkIA4uW4yea/kPKZ9/HOJbyOgSyx7BoVvcD0LTVuckmJJXK1ribyIkBCDNe13+xX2h7UkcjUzQ72K6WwMZawO5Ib1piXQXACbpsDn146+NTgeD7IG4ZIkWMC0ptD14RXNK8oMyDq1q0roCOUylYrqJhfgPVXGTHq9es0mBPooFC6VdeAKe5AMDlXCh0xBn45kvU18BqqY1gzcGNYxTUN0q/LUvVs6w7t4CMidYsCMOsdrVWWilSRQdVzhRB89pXgHyHQc18R216Gk7jakm+uZGI3fpDLWmLV7GVDVBtRyDW1bSkPYixH5Lkl90ZYtxB0W3V4B5AfrePZdlkcUsUyJPh2LAxamfmnEf0GT4ggQe41Nu9m26LqSZOg9d6asvUrZsg0ZIdbNpznlNc/76WDD/7bHX/47xzciI5LhHDChpAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 04\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/4aae148b1988ba271b336ed8e2299443/c7dcc/001-04.png\"\n        srcset=\"/devHistoryBlog/static/4aae148b1988ba271b336ed8e2299443/8ff5a/001-04.png 240w,\n/devHistoryBlog/static/4aae148b1988ba271b336ed8e2299443/e85cb/001-04.png 480w,\n/devHistoryBlog/static/4aae148b1988ba271b336ed8e2299443/c7dcc/001-04.png 641w\"\n        sizes=\"(max-width: 641px) 100vw, 641px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<h4>#. /var/log/mysql/mysql-slow.log 파일 확인</h4>\n<ul>\n<li>아래와 같은 형식으로 로그파일에 기록됨</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Query_time : 쿼리 처리시간  \n# Lock_time : lock이 걸린 횟수  \n# Row_sent : 조회 결과 Row 수  \n# Rows_examined : 조회 대상 ROW 수  \n\n# User@Host: DB_유저[DB_유저] @ server_hostname [서버IP]\n# Query_time: 0.000599  Lock_time: 0.000163 Rows_sent: 3  Rows_examined: 86\nSET timestamp=1489118717;\nselect count(*)</code></pre></div>\n<br>\n2021.02.01. 오늘 slow query 찾아보다가 내용이 부실해서 추가함...","fields":{"tagSlugs":["/tags/slow-query/"],"slug":"/works/posts/2020-12-22--001.md"},"frontmatter":{"title":"[MariaDB] SlowQuery 설정 및 확인","tags":["slow query"],"date":"2020-12-22","description":""}}},"pageContext":{"slug":"/works/posts/2020-12-22--001.md"}},"staticQueryHashes":[]}