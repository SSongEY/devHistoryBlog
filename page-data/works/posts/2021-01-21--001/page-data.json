{"componentChunkName":"component---src-templates-post-template-jsx","path":"/works/posts/2021-01-21--001","result":{"data":{"site":{"siteMetadata":{"title":"Blog by Eunyoung","subtitle":"EY's 개발 히스토리 블로그","copyright":"© All rights reserved.","author":{"name":"EunYoung","twitter":"#"},"disqusShortname":"","url":"https://eunyoung-autocrypt.github.io"}},"markdownRemark":{"id":"3a18f52c-82e7-593e-9b50-3843f1dc0ce7","html":"<h3>#1. Jenkins Item 생성 (Pull Request)</h3>\n<ul>\n<li>pipeline 선택\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/12a2bc787d353b4201c6980d1c078589/1e088/001-01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 840px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 73.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABJ0AAASdAHeZh94AAACS0lEQVQ4y42SyY7TQBCG/YRceCBOiDsSD8GNAxzgPtIomiGQkFmyOIn33W4v7SVOfqraTlg0g4j0uaq6O1V/dbVWNy2qphtpIdsOkny2eSX/n1KiqGpoiShwNbnFt8UDbmYLTKYz3M5+kJ3DiTJ4SU6IgVj88v8mzhCkOSXMcjyu1tjuDVi2C8OyYRJs/TBCEMXwghBulKg//IsoKwaFy42O9XYHxw8RU4EoFcqGSaYI4pQSpvBJyXOwypAVVrJGWnbICkmUyEq2FdK8/APeu/hPcD6jtW2D2fdr7PQldFKq6xsY+z3KskQtJeq6VlayP9qqqiCJs1U+nW+aBhp//NUVAluH6/rYbNbY7XawLAumacJxHOypAMe27dD9WjAMg/YstW4apjrneZ4qTgpbiLpHQvfmui5EnisV8qyOkJIUUNwof1wnIXKMGc7DaA195qstXC+ARwkrelPd4XBJxjT0PrmTyxonH2O2nLDvj0QPres68I/vjKVb1IpNbYZhiCiK4Pv+xee2giBQa2wZXmebJAkVoDtsKWFJky6K4gJXPJBK5nQ6KY7HIzD6T8H7LE7jdu7XezysNljc3dPE51gs7rBaLjH9OqVB2MiyFGmaKqVxHCufrVKuiBCSUp66xpeLA9HR2EUA2zTUJj8FIQQly5DToFg5+0LkKmaGWAznCO5MO/QV3k/u8OrDBK8/3uCRBtNTAVZ+ntxzcIu/x+odno4Sbz5N8OLtZ7x89wXX6y3KPIYfDIOIxoHwpbM9t8oMg2GfWw7V1H8CT5tuWG4KgaYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 01\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/12a2bc787d353b4201c6980d1c078589/1e088/001-01.png\"\n        srcset=\"/devHistoryBlog/static/12a2bc787d353b4201c6980d1c078589/8ff5a/001-01.png 240w,\n/devHistoryBlog/static/12a2bc787d353b4201c6980d1c078589/e85cb/001-01.png 480w,\n/devHistoryBlog/static/12a2bc787d353b4201c6980d1c078589/1e088/001-01.png 840w\"\n        sizes=\"(max-width: 840px) 100vw, 840px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<br>\n<ul>\n<li>Build Trigger에서 generic Webhook Trigger를 선택한다.</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/b7aaf19c6c7610288e3e81807ee675ca/f8915/001-02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 748px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABXElEQVQoz52T626DMAyFef9XbCHcIYlJYOu4Vjq13a7qpE3a9sNyIOHLOcciyfMcTdNA+uVywfV6xb7t2Pcd67pxrX+qRGB1XaMoCowxYhxHTNOkfZnnfwDrCsbkrNCgqio45zAMA4hID4jSbdt+XUlZlsgyowplLSBrLYOtPnddp+DvPn59/1RYtg62a1GVFWrN0iCy9XVdMLNlqeUHe6+gz3VC5NH3PZz3atVzF5WSbcGDSs8njiTTi9L0rKrTNEVuDE4n3ssy9OzoPkQGhhAQuaSHGBhKCEPQAdU+oqEJpYvw8R0Hf3Qch5Zmqxl/tZ8ITFRJbqLM81C63qJlmKMBnSO01sPzJRJFCFH7NEY98zEvClagKBSbMlm1rd0i7wg9sVqOg/gdSQxyKe/pwLgKzr4Pb6r0eNh9WnaOc+RpClChrIr8vSv4ka33pC6c7nHmGlWEDZP+BGL5Bj1T+QpEj5ytAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 02\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/b7aaf19c6c7610288e3e81807ee675ca/f8915/001-02.png\"\n        srcset=\"/devHistoryBlog/static/b7aaf19c6c7610288e3e81807ee675ca/8ff5a/001-02.png 240w,\n/devHistoryBlog/static/b7aaf19c6c7610288e3e81807ee675ca/e85cb/001-02.png 480w,\n/devHistoryBlog/static/b7aaf19c6c7610288e3e81807ee675ca/f8915/001-02.png 748w\"\n        sizes=\"(max-width: 748px) 100vw, 748px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<h3>#2. webhook token 설정</h3>\n<ul>\n<li>BitBucket 에서 설정했던 token 값을 넣는다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/22475/001-06.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 14.583333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABJ0AAASdAHeZh94AAAAZ0lEQVQI15WOSQrAIBRDvf8dFRGcikNF96mxA5SuunjkJ5BPRCkFrTX03n8xxni4fYwRwhgD5xxSSouc84szz5+cZe89QgjY5s1R1loIKRWUUtBar8cM7VQuJ7XWB/r9Uj68YY8LmR//TuJjPxbLEwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 06\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/d9199/001-06.png\"\n        srcset=\"/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/8ff5a/001-06.png 240w,\n/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/e85cb/001-06.png 480w,\n/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/d9199/001-06.png 960w,\n/devHistoryBlog/static/12d9fb97aec68c7607403df32b73ccf5/22475/001-06.png 1039w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<br>\n<h3>#3. Parameters 정의</h3>\n<ul>\n<li>request payload 에서 사용할 값들을 정의한다.</li>\n<li>bitbucket webhook 에 대한 각 이벤트 request payload는 <a href=\"https://support.atlassian.com/bitbucket-cloud/docs/event-payloads/\">여기</a> 에서 볼 수 있다. 근데.. 난 보기 불편하다.  </li>\n</ul>\n<h4>#3.1. 아래와 같이 paramters를 캐치할 수 있는 폼이 있는데, 해당 hook은 POST method 형식이므로 맨 첫번째를 선택한다.</h4>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/1ac29/001-03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA4ElEQVQY02WQSY6FMBBDuf8hIfD5DKFC5qHCpp10qzdYTxXjDJYY7LyQmGgSSszlupiogKuR5dVNm8g7itVdto1D4FoHt+3kg43RpRhKSbWmyul5Sic/T0uYe15jyQG72rD37bKZ53Oc5DiCe/nY7xe4fQ/HAfA0PvW6mrXlJIQUwi8fjrE3WyuPUyuVQywp5dhmwYypJc1ETqnmDJ5SAOfMXYN17iIC2hhMdd9I4DGNxdIUWw+j6vfOvxmwfZ4nKZXw/Ev95J95a/Deo830Dq01EUkp4e8eohwhVoc/9NIP6buNlVAls6gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 03\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/d9199/001-03.png\"\n        srcset=\"/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/8ff5a/001-03.png 240w,\n/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/e85cb/001-03.png 480w,\n/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/d9199/001-03.png 960w,\n/devHistoryBlog/static/3c194c47a2980c25c706517b4754ab68/1ac29/001-03.png 1022w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<h4>#3.2. 사용할 변수들을 정의한다.</h4>\n<ul>\n<li>Variable : 변수로 사용할 이름  </li>\n<li>Expression : payload에서 사용 할 값  </li>\n<li>JSONPath : payload가 json으로 들어오므로 해당 값을 선택한다.</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/51ed8/001-04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 67.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABJ0AAASdAHeZh94AAABNklEQVQ4y6VTy46DMAzM/39e772xPFQghAAJD2nWE0hLKVpV7GGIYycT22NUlmUoigJlWcJ7fw3OwdxucNZCGWOwLAvmecY4jtcgpPZ+h+97qF4+bduGAEmnabqEBcAoq2LJJLxc7q5sriFDJ5v/ZEfElimt65DhkXA+ufRNP1Vd1+i6DlYUIvFqd6iMhREf/U3bScyGSnjpr9JVkiRommYlsysxUQuJEZJeHgiE4uOFVzbnGSu3NfNsFLg6P8FtPp6NiL1/YcswTVPkeQ6q/UP7UYKzqbVG3Rg8dBugxcdKzLZWVRXO7H18RBVCZqRcNt0zk02xd4goEnsKNB7E2ommKMI71h7GPW2+/M3oBMJVkFXhqHS098of1Y29/lCZSroowGEs9k3nfhiG7a/wIeth6J+xiF+/PT+q/j0MwQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 04\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/d9199/001-04.png\"\n        srcset=\"/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/8ff5a/001-04.png 240w,\n/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/e85cb/001-04.png 480w,\n/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/d9199/001-04.png 960w,\n/devHistoryBlog/static/30f7cd78d215eb1127cffec34d0e0a9e/51ed8/001-04.png 1021w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<h4>#3.3. 정의한 변수들</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. SOURCE_BRANCH  \n  -- PR 타켓 branch  \n  -- expression: $.pullrequest.source.branch.name\n\n2. COMMENT_URL\n  -- pipeline에서 정의한 stage 수행 시 comment 기록를 위한 url  \n  -- expression: $.pullrequest.links.comments.href\n\n3. DECLINE_URL\n  -- pipeline에서 정의한 stage 실패 시 PR decline을 위한 url  \n  -- expression: $.pullrequest.links.decline.href\n\n4. REPO_URL\n  -- git repository url \n  -- expression: $.pullrequest.destination.repository.links.html.href</code></pre></div>\n<br>\n<h4>#4. Pipeline 작성</h4>\n<ul>\n<li>맨 아래 pipeline을 작성하는 폼이 있다.</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/aa61c/001-07.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 27.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABJ0AAASdAHeZh94AAAAb0lEQVQY063Pyw6EIAwF0P7/b+oOShVRoAzeUVYTVyrT5CR9JDcpDcOInDNSSn9B1trWnKG9VDPIGINti8egL0O0+ZQC9itIRNohxvjY+VkIAc45MDOME1Apit6qtTb7XkEsEya/HPw983W3YP7xBTau04B4QjEzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 07\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/d9199/001-07.png\"\n        srcset=\"/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/8ff5a/001-07.png 240w,\n/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/e85cb/001-07.png 480w,\n/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/d9199/001-07.png 960w,\n/devHistoryBlog/static/8c85c8f1306974665d393124dcc29696/aa61c/001-07.png 1065w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<ul>\n<li>아래와 같이 작성한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">node {\n    withCredentials([usernameColonPassword(credentialsId: &#39;bitbucket-auth-id-pw&#39;, variable: &#39;USER&#39;)]) {\n        stage (&#39;Clone&#39;) {\n            sh&#39;&#39;&#39;\n                echo SOURCE_BRANCH: $SOURCE_BRANCH\n                echo REPO_URL : $REPO_URL\n                echo DECLINE_URL: $DECLINE_URL\n                echo COMMENT_URL: $COMMENT_URL\n            &#39;&#39;&#39;\n            \n            try {\n                \n                git branch: &#39;$SOURCE_BRANCH&#39;, credentialsId: &#39;bitbucket-auth-id-pw&#39;, url: &#39;$REPO_URL&#39;\n            \n            } catch(e) {\n                sh &#39;&#39;&#39;\n                    curl -X POST -u &quot;$USER&quot; $COMMENT_URL -d &#39;{&quot;content&quot;: {&quot;raw&quot;: &quot;[CLONE] FAIL&quot;}}&#39; -H &#39;Content-Type: application/json&#39;;\n                    curl -X POST -u &quot;$USER&quot; $DECLINE_URL -d &#39;{&quot;content&quot;: {&quot;raw&quot;: &quot;[CLONE] FAIL&quot;}}&#39; -H &#39;Content-Type: application/json&#39;;\n                    echo [CLONE] FAIL;\n                    exit 1;\n                &#39;&#39;&#39;\n            }\n        }\n        \n        stage (&#39;Build&#39;) {\n        \n            sh &#39;&#39;&#39;\n            {\n                echo [BUILD - BACKEND]\n                chmod +x ./gradlew\n                ./gradlew clean build -x test \\\n                &amp;&amp; curl -X POST -u &quot;$USER&quot; $COMMENT_URL -d &#39;{&quot;content&quot;: {&quot;raw&quot;: &quot;[BUILD] SUCCESS&quot;}}&#39; -H &#39;Content-Type: application/json&#39; &gt; /dev/null 2&gt;&amp;1 \\\n                &amp;&amp; echo [BUILD] SUCCESS;\n            }||\\\n            {\n                curl -X POST -u &quot;$USER&quot; $COMMENT_URL -d &#39;{&quot;content&quot;: {&quot;raw&quot;: &quot;[BUILD] FAIL&quot;}}&#39; -H &#39;Content-Type: application/json&#39;;\n                curl -X POST -u &quot;$USER&quot; $DECLINE_URL -d &#39;{&quot;content&quot;: {&quot;raw&quot;: &quot;[BUILD] FAIL&quot;}}&#39; -H &#39;Content-Type: application/json&#39;;\n                echo [BUILD] FAIL;\n                exit 1;\n            }\n            &#39;&#39;&#39;\n        }\n       \n    }\n}</code></pre></div>\n<br>\n<h5>#. 진행된 시나리오 확인</h5>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># PR 이벤트 시나리오\n  #1. develop branch에 Pull Request 이벤트 발생\n  #2. Bitbucket 에서 Webhook 발생 ( to jenkins )\n  #3. Jenkins 에서 해당 Webhook Payload를 분석하여 정의된 Pipeline 실행\n    # Pipeline\n     #1.1. clone 타켓 branch  \n       -. clone 실패 시 해당 PR에 comment 등록 (clone fail)\n    \n     #1.2. 테스트 없이 소스코드 빌드 ( 컴파일 오류 체크 )    \n       -. 빌드 성공 시 해당 PR에 comment 등록 (build success)  \n       -. 빌드 실패 시 \n         -1.2.1. 해당 PR에 comment 등록 (build fail) \n         -1.2.2. PR decline 요청 \n         -1.2.3. 파이프라인 종료  </code></pre></div>\n<p>[계속]</p>","fields":{"tagSlugs":["/tags/ci-cd/","/tags/jenkins/","/tags/pipeline/"],"slug":"/works/posts/2021-01-21--001"},"frontmatter":{"title":"[작업로그] 테스트 자동화 구축 #4","tags":["ci/cd","jenkins","Pipeline"],"date":"2021-01-21","description":"Jenkins Item 등록 및 Pipeline 작성"}}},"pageContext":{"slug":"/works/posts/2021-01-21--001"}},"staticQueryHashes":[]}