{"componentChunkName":"component---src-templates-post-template-jsx","path":"/works/posts/2020-12-22--001.md","result":{"data":{"site":{"siteMetadata":{"title":"Blog by Eunyoung","subtitle":"일상 & 작업 기록 블로그","copyright":"© All rights reserved.","author":{"name":"EunYoung","twitter":"#"},"disqusShortname":"","url":"https://eunyoung-autocrypt.github.io"}},"markdownRemark":{"id":"e76cd80d-f1a0-5585-bbd5-9bf3dd8f88a6","html":"<h3>Slow Query(슬로우쿼리)</h3>\n<ul>\n<li>Slow Query(슬로우쿼리)는 지정된 시간보다 실행하는데 오래걸리는 쿼리에 대한 log</li>\n<li>특정 작업이 오래 걸린다면 로그를 통해 원인을 파악이 가능</li>\n</ul>\n<br>\n<h3>#. 설정 확인</h3>\n<ul>\n<li>slow query log 설정 상태 확인</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># slow query 설정 정보\nmysql> show global variables like 'slow%';</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/c9a4118eaae557a4491e4650e3480b65/e4c9a/001-01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 591px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 40.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABS0lEQVQoz21S2XLCMBDLl/SEJMUh2LkT54QA7f9/kLrawgwz9EGzHlsra2UH62XB5XrCchwwzl7WC7yv0AmGoYYfGoxjg6K0mOWcvKKyumedwbz06IUTxR+Ivz4RVHWGWtC0ObjufCnNBziXoKwc2q7UM5ftkeVEqkIuS7SSmyShilE0KKSpFyendVSx0zopkYSD3entR3G1T2MYE8IkRKQ12cfKiaJ35atD3kgHdEk3de3g+1odHKxRRzuzleboGWmsnPg2rgpylMv1iPN5xvfPWTLqsYpLipAwSW47s8Fm+4pt+PYEOqVgdENgJSs2cdRFAqa7aerUNTNr2kIeoMU4eT0fJAJGRIzCy4sU4ePIHLPtCs2Pzax8uXnx2lQ3uebE0XkBo7iDYqzR48j8DoN8ATr6yzDTh5jmTvZbeWmLz83Lv+PecRcjfgHqGv0XtzcZfAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 01\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/c9a4118eaae557a4491e4650e3480b65/e4c9a/001-01.png\"\n        srcset=\"/devHistoryBlog/static/c9a4118eaae557a4491e4650e3480b65/8ff5a/001-01.png 240w,\n/devHistoryBlog/static/c9a4118eaae557a4491e4650e3480b65/e85cb/001-01.png 480w,\n/devHistoryBlog/static/c9a4118eaae557a4491e4650e3480b65/e4c9a/001-01.png 591w\"\n        sizes=\"(max-width: 591px) 100vw, 591px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 소요시간 확인\nmysql> show global variables like '%long_query_time%';</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/e075030c0255aaa2bda14dffa54a6b21/2c288/001-02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 684px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAuUlEQVQY03WQ6Q6CQAyEeRWPKKhcwi7syaLg+7/R2G5iIoI/JptOt1+mTcLoMD4ctJEYgoV1fZQfNPkezivqdbGWsobSAq2oyNfw1OPa2A6G5rPLEQk3ubBskoSsUJQZARSq+oq8SOPHc7pfKc0OUd8eAcsI4lT8aiNQ17eYKIwWbVvGj6fzbgVk79dP7k1OIBmBglbitOzxKtMc0KtmMfSB/FPCg3wnlnUdntOA+RXonmax7lbCLb0BPbyb2JgjfMcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 02\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/e075030c0255aaa2bda14dffa54a6b21/2c288/001-02.png\"\n        srcset=\"/devHistoryBlog/static/e075030c0255aaa2bda14dffa54a6b21/8ff5a/001-02.png 240w,\n/devHistoryBlog/static/e075030c0255aaa2bda14dffa54a6b21/e85cb/001-02.png 480w,\n/devHistoryBlog/static/e075030c0255aaa2bda14dffa54a6b21/2c288/001-02.png 684w\"\n        sizes=\"(max-width: 684px) 100vw, 684px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 로그파일 저장 방법 (FILE / TABLE)\nmysql> show global variables like '%log_output%';</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/ab24097d71c08c59a8d7996770dbbcb2/6114d/001-03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 623px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 30.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVQY042QWQ7CMAxEcxTWLoCAtmmStknaQrn/kQbbbBKLxMfI8cR+iUYNY8B0GdB5hxBbcO8aLTX2Lc5TRG0KuRtPAdZpmrXQ5A2DJ78R3weHLF9CGVtQY0UMajtDgKMMWldis13LYL5ZPcX9Vy9bQFX6cAfVaNqbKr2XWtcHpDSUpPMPffNTAdJS5438iKFJOkNR7nA6R3nosfgL/C7FS5FgnEuIjn6mMU29ZMIPZfkL+I9UWe0lK86Nq7ElxtHTuaLgj0iS2d8w1hVgL7m5BfplWQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 03\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/ab24097d71c08c59a8d7996770dbbcb2/6114d/001-03.png\"\n        srcset=\"/devHistoryBlog/static/ab24097d71c08c59a8d7996770dbbcb2/8ff5a/001-03.png 240w,\n/devHistoryBlog/static/ab24097d71c08c59a8d7996770dbbcb2/e85cb/001-03.png 480w,\n/devHistoryBlog/static/ab24097d71c08c59a8d7996770dbbcb2/6114d/001-03.png 623w\"\n        sizes=\"(max-width: 623px) 100vw, 623px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<h3>#. 설정 방법</h3>\n<h4>#1. my.cnf 파일 설정 및 재기동</h4>\n<ul>\n<li>파일 설정</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 3초 이상 소요된 쿼리를 테이블에 기록\n[mysqld]\nslow_query_log=1\nlong_query_time = 3\n\nlog_output = TABLE\nlog_slow_queries       = /var/log/mysql/mysql-slow.log</code></pre></div>\n<ul>\n<li>재기동</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ /etc/init.d/mysqld restart</code></pre></div>\n<br>\n<h4>#2. 쿼리문 사용 (편하다…, 재기동시 날라간다…)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 해당 값(초) 이상의 로그 기록\nmysql> set global long_query_time = 3;\n\n# 슬로우쿼리 활성 여부 (0 = 비활성 / 1 = 활성)\nmysql> set global slow_query_log = 1;\n\n# 로그파일 저장 방법 변경\nmysql> set global log_output = 'TABLE';</code></pre></div>\n<br>\n<h3>#. 로그 확인</h3>\n<h4>#. mysql.slow_log 테이블 확인</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mysql> select sleep(3);\n\nmysql> select * from mysql.slow_log\\G</code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/4aae148b1988ba271b336ed8e2299443/c7dcc/001-04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 641px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 65.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpUlEQVQ4y41T2XKCQBDkR1KJUUG8AEG5TwWvSvL/X9OZHhIrxhw+DLNb7PZ2T88YURwgTTeIYh/rjQvuXW+me281h+v26024QrB2JFw9FydrzOcmxuYTTGtwCSOMfNR1hqrJkRexrvMiQVWlKMoEoQDxct1kui/rPjOuH/HguFMYfMEPHDTbQsHKMtbDbVdrFEWERBRwfTy1OJ07YT1VNtPZ+Crs6QjGaPyoL+z3WzTCshSwWvLL6xHdvsHb21lzGHrw/AWWjo3J5FmkDq6kXiQT0JGa7doKlTDspaXohNEnMFlRCc+aVl8zS0B/CoNUA5HcCcMeJMNKmPAnJUzskebvF38DNSiBxrCOdJtMZ3Prxj3Ter6JHwHpFAGzPNZcVWS47C/YQ2E4lIPDXyXeAFIOAQ7HnRpCY1iC4ehBmbFuZHs34Nh8FMtNbD/appBeZHMn6Vp7rJA22ojDfd3uAORnIXVs277vsjxCJqArmZKJsOfULJb2xYj/QmtIIPYa22N/2GK3K9VpGvYp+a9WuWLoyKwS1A+WOqPMHEE6zv1XoHtA3wEVf5LfaiKhrgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 04\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/4aae148b1988ba271b336ed8e2299443/c7dcc/001-04.png\"\n        srcset=\"/devHistoryBlog/static/4aae148b1988ba271b336ed8e2299443/8ff5a/001-04.png 240w,\n/devHistoryBlog/static/4aae148b1988ba271b336ed8e2299443/e85cb/001-04.png 480w,\n/devHistoryBlog/static/4aae148b1988ba271b336ed8e2299443/c7dcc/001-04.png 641w\"\n        sizes=\"(max-width: 641px) 100vw, 641px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<h4>#. /var/log/mysql/mysql-slow.log 파일 확인</h4>\n<ul>\n<li>아래와 같은 형식으로 로그파일에 기록됨</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Query_time : 쿼리 처리시간  \n# Lock_time : lock이 걸린 횟수  \n# Row_sent : 조회 결과 Row 수  \n# Rows_examined : 조회 대상 ROW 수  \n\n# User@Host: DB_유저[DB_유저] @ server_hostname [서버IP]\n# Query_time: 0.000599  Lock_time: 0.000163 Rows_sent: 3  Rows_examined: 86\nSET timestamp=1489118717;\nselect count(*)</code></pre></div>\n<br>\n2021.02.01. 오늘 slow query 찾아보다가 내용이 부실해서 추가함...","fields":{"tagSlugs":["/tags/slow-query/"],"slug":"/works/posts/2020-12-22--001.md"},"frontmatter":{"title":"[MariaDB] SlowQuery 설정 및 확인","tags":["slow query"],"date":"2020-12-22","description":""}}},"pageContext":{"slug":"/works/posts/2020-12-22--001.md"}},"staticQueryHashes":[]}