{"componentChunkName":"component---src-templates-post-template-jsx","path":"/works/posts/2021-01-23--002","result":{"data":{"site":{"siteMetadata":{"title":"Blog by Eunyoung","subtitle":"일상 & 작업 기록 블로그","copyright":"© All rights reserved.","author":{"name":"EunYoung","twitter":"#"},"disqusShortname":"","url":"https://eunyoung-autocrypt.github.io"}},"markdownRemark":{"id":"3632678b-6c0c-514e-9b3d-dd99cf5fd434","html":"<p><span class=\"title__sub1\"> Sonarqube ? </span></p>\n<ul>\n<li>20개 이상의 프로그래밍 언어에서 버그, 코드 스멜, 보안 취약점을 발견할 목적으로 정적 코드 분석으로 자동 리뷰를 수행하기 위한 지속적인 코드 품질 검사용 오픈 소스 플랫폼 </li>\n<li>중복 코드, 코딩 표준, 유닛 테스트, 코드 커버리지, 코드 복잡도, 주석, 버그 및 보안 취약점의 보고서를 제공.</li>\n<li>sonar scanner에게 정적 분석 관련 데이터 제공</li>\n</ul>\n<br>\n<p><span class=\"title__sub1\"> 정적분석을 위한 Sonarqube 설치 </span></p>\n<ul>\n<li><a href=\"https://hub.docker.com/_/sonarqube/\">https://hub.docker.com/_/sonarqube/</a></li>\n</ul>\n<p><span class=\"title__sub2\">1. host 설정</span></p>\n<ul>\n<li>sonarqube 내부에 Elasticsearch 를 사용하고 있기 때문에 필요 설정이 있다\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/7a24aa1ce8afd1f2e94e6157c789e279/e619b/002-01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 787px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 38.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABFElEQVQoz5WR2W6DMBBF/f+f2IdGzUICBON9wcDtzNBWUd+CdDTji3Vnser6EadLh8u9x9ftgY/TGeeuxydpozZ491MhJljnYb2H80FyYz2m2cCHiFKrUF9jKcilIuYspFwQUxZNzS5gMAGjPeLkEp424qEd+tlj0Bbj7OQ8GC9aN1m4yAZkRGZciE0ZZair+6jxNE4YyUBTh5oKcTFtHTTpnPNd46P8t9R9SAmeJjQ0FXcoI/NY2lgRf0fmytu2obWG5Yf2D9GXg7osct73HarWhXaVkHMl0yDdTLOVfF03rG2luB7xlfWV414jFD/A+dbj9hhxvQ940ssypSx/HbyD4pdxtJeZjHmp2EHj7lK5tff5BjK/bJKwOvwFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"002 01\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/7a24aa1ce8afd1f2e94e6157c789e279/e619b/002-01.png\"\n        srcset=\"/devHistoryBlog/static/7a24aa1ce8afd1f2e94e6157c789e279/8ff5a/002-01.png 240w,\n/devHistoryBlog/static/7a24aa1ce8afd1f2e94e6157c789e279/e85cb/002-01.png 480w,\n/devHistoryBlog/static/7a24aa1ce8afd1f2e94e6157c789e279/e619b/002-01.png 787w\"\n        sizes=\"(max-width: 787px) 100vw, 787px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># max_map_count ?\nThis file contains the maximum number of memory map areas a process may have. Memory map areas are used as a side-effect of calling malloc, directly by mmap and mprotect, and also when loading shared libraries.\nWhile most applications need less than a thousand maps, certain programs, particularly malloc debuggers, may consume lots of them, e.g., up to one or two maps per allocation.\nThe default value is 65536.</code></pre></div>\n<br>\n<p><span class=\"title__sub2\">2. DB 및 Volumes 설정 내용 </span>\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/5ab97f9516fe199f8f2313f58a223c46/0f67e/002-02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 921px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABVklEQVQoz51Ti27DIAzk/z9ymrQubQMBkkCeEM/nhGyVqmpbpZPtAPbZ56q3j4reL1eqakPbtlE+sP0T6vOuKQ6jBL/9vUx4N5ZCHCgMAw3jJH4f4mnxDQWBjuNpXl4WU67tpV1jPTWuPa2G9S1Z3wkQ48y1nSRuu158zxaw7K8pkcIh2r7qhqq7Eb9CzEWAG3/frRVcbrjLVjuqjJPk3dERZq+s31lJ1T4c1cMZ9xGWESdqh4l8GMmz7+PM8UxhWmhc0nfLaLdunNBNKVPOmW0S4FvO25/EUYUJ5lTmUWYHG1iMUkCKrCstyyr+04SR1a1ZaaBxj4LAF7DvDhEwHs0ddUziGVOF1dgHr7l1KwzxEKoV1bEJ2jpJbI4COEN3CzP+mVQYGr4MgKHjyyJOv4+irAb2Uf5JOZ9IMuP8mNCzolgLPCyPdxuEGbYAbJEcZ5jfK3G+AI8Bot12kIQaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"002 02\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/5ab97f9516fe199f8f2313f58a223c46/0f67e/002-02.png\"\n        srcset=\"/devHistoryBlog/static/5ab97f9516fe199f8f2313f58a223c46/8ff5a/002-02.png 240w,\n/devHistoryBlog/static/5ab97f9516fe199f8f2313f58a223c46/e85cb/002-02.png 480w,\n/devHistoryBlog/static/5ab97f9516fe199f8f2313f58a223c46/0f67e/002-02.png 921w\"\n        sizes=\"(max-width: 921px) 100vw, 921px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<p><span class=\"title__sub2\">3. Compose 파일 작성</span></p>\n<ul>\n<li>sonarqube develop edition 버전 설치 (trial 라이센스 문의 함)</li>\n<li>embedded db : postgres 사용</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">version: \"3.7\"\nservices:\n  db:\n    image: postgres\n    container_name: sonar-postgres\n    restart: always\n    environment:\n      POSTGRES_USER: sonar\n      PASTGRES_PASSWORD: sonar\n      TZ: Asia/Seoul\n      POSTGRES_HOST_AUTH_METHOD: trust\n    volumes:\n      - ~/docker-volumes/sonar-postgres/postgres:/var/lib/postgresql/data\n  \n  sonarqube:\n    image: sonarqube:8.6.1-developer\n    container_name: sonarqube\n    restart: always\n    environment:\n      SONARQUBE_HOME: ./\n      SONARQUBE_JDBC_USERNAME: sonar\n      SONARQUBE_JDBC_PASSWORD: sonar\n      SONARQUBE_JDBC_URL: jdbc:postgresql://db:5432/sonar\n    depends_on:\n      - db\n    ports:\n      - 10002:9000\n    volumes:\n      - ~/docker-volumes/sonar-postgres/sonarqube/data:/opt/sonarqube/data\n      - ~/docker-volumes/sonar-postgres/sonarqube/extensions:/opt/sonarqube/extensions\n      - ~/docker-volumes/sonar-postgres/sonarqube/logs:/opt/sonarqube/logs\n      - ~/docker-volumes/sonar-postgres/temp:/opt/sonarqube/temp</code></pre></div>\n<br>\n<p><span class=\"title__sub2\">4. 서비스 기동</span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ docker-compose -f sonarqube-compose.yml up -d</code></pre></div>\n<br>\n<p><span class=\"title__sub1\"> 정적분석을 위한 Sonarqube 프로젝트 생성 및</span> </p>\n<p><span class=\"title__sub2\">1. Sonarqube 프로젝트 생성</span></p>\n<ul>\n<li>10002 포트로 접속 후 로그인 &#x26; 프로젝트 생성\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/1ec4e0187cad189410f134a4520be1a9/eea79/002-05.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 502px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 77.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABJ0AAASdAHeZh94AAAB8ElEQVQ4y52T2ZKbMBBF+f//mqc82FWJAwaz2UJskoWQwEuSumnE2GUm48kkD6ckoeZye8FrmgbbIEAURQhoZYwhjmOE09n3wYoCwzCg73sYY/6KJ4TAbrdDGIbYbrfI8/1dfLPZoKoqWGud4GfwDAWP4+g4nU7OzeP5X8RmwcmqXdp+G/Reas/uvKoqsV6tKb1viCjlknMopVyw1vpOr/s703kwA072BN3rpUOpW+x4jLzMUR1L2KuFudCXr+Yp559nxF2MdbXGdbw+ZEiCrSLBYoeEJUh5ikIwlCRciAKM9tM6wSV3sJaBC46wpCbWW4hGYGrs7PC1y0kSEwny/R5Zls1dp/RjepakKY1Q6O4jeh4EvhupLM1Q5IzuE7Rt68rganiUEgUr0NSNQ7YCRyGhOwro5+JP+7l2j3sNSe9qur9Ngku5qkusvq7wPfThRz7iLEYtanSmg+oVlHkfbbQTunV8XsmhNC2iMkLCEzS0t78s9FWjO3foLn+izgrDjwEbscELe8HFXhad9oQU2PMDDsS+IFgOXnPn8BmTO6klhBawxi5m0nMz1nVUFw11VK4uSnWufh8xCd3Elv8yiXwJMqyjAxpJ6QyvdaECf8iDq4VDRV1LixoZb3CcnN0DzKLgn8X9yyO5Ggf7XwJv+Q1Khrnqg7kEqgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"002 05\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/1ec4e0187cad189410f134a4520be1a9/eea79/002-05.png\"\n        srcset=\"/devHistoryBlog/static/1ec4e0187cad189410f134a4520be1a9/8ff5a/002-05.png 240w,\n/devHistoryBlog/static/1ec4e0187cad189410f134a4520be1a9/e85cb/002-05.png 480w,\n/devHistoryBlog/static/1ec4e0187cad189410f134a4520be1a9/eea79/002-05.png 502w\"\n        sizes=\"(max-width: 502px) 100vw, 502px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n<br></li>\n<li>프로젝트 토큰 생성\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/dcd094aa105fa8673ecc2a2b2322129a/e619b/002-06.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 787px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 32.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABJ0AAASdAHeZh94AAAAyklEQVQY052RSQ7DIAxFuf/deoRuukmjJoQxzPm1UVql06aWPjYGHtiI03nAZZQIq4e1DjFGbNuG1tqLKqvWj/y7xFU5TNoRzEJrDWNMB/5rgoeQCsZJQhkLHxJirsi1Ie3iWPuIq7R9Lxtf+k2Ch1wq5kVh0QZuDUiFyqNHkuvi2MWMkarhtV/WgRzUUmCoZKUUpJSwziFQL0MIXdzXRGq1dM/z9ZFPqe/JOR9KpsRMIE1A7uNNKgzTQmD/BHQwHY7H+Q5kz0D+lDurt9Xxmb/8kgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"002 06\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/dcd094aa105fa8673ecc2a2b2322129a/e619b/002-06.png\"\n        srcset=\"/devHistoryBlog/static/dcd094aa105fa8673ecc2a2b2322129a/8ff5a/002-06.png 240w,\n/devHistoryBlog/static/dcd094aa105fa8673ecc2a2b2322129a/e85cb/002-06.png 480w,\n/devHistoryBlog/static/dcd094aa105fa8673ecc2a2b2322129a/e619b/002-06.png 787w\"\n        sizes=\"(max-width: 787px) 100vw, 787px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n<br></li>\n<li>을 하면 아래와 같이 sonar scanner 를 사용하기 위한 설정 방법이 나온다.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/bf81404469ad3593a0cd1a85abd3233d/c65fa/002-04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 40.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA4klEQVQY032P/U7DIBTFef9X8hFctrj/msVaugLKZynbQKDUi1WjZtsv4d6bwDmHiyZ3CiGklEop8w3KXEIKPnijDSGEUgpVSomYmqy19dip3GUpyz8QGB8If9geuLbm5I3z2vmY5+Uuqx1KKdfgaVrjnXOwQs45xbgOMUYIuGqB4K7rOox74Ngf6TdkGNb1hmFgjPFfCMEJZVwqSE5Ga9h+HMfz+eJDeL9G+MvF14dV3GPcPrf4E8hRSmlgrbV/DT9AGBdSm7GK4Xtt+/K03z9uNtvdrmkaIYS8jZLy9Y2D+AM7O8a81R8GFwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"002 04\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/bf81404469ad3593a0cd1a85abd3233d/d9199/002-04.png\"\n        srcset=\"/devHistoryBlog/static/bf81404469ad3593a0cd1a85abd3233d/8ff5a/002-04.png 240w,\n/devHistoryBlog/static/bf81404469ad3593a0cd1a85abd3233d/e85cb/002-04.png 480w,\n/devHistoryBlog/static/bf81404469ad3593a0cd1a85abd3233d/d9199/002-04.png 960w,\n/devHistoryBlog/static/bf81404469ad3593a0cd1a85abd3233d/c65fa/002-04.png 1434w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n<br>\n<p><span class=\"title__sub2\">2. Scanner 설정 및 실행</span></p>\n<ul>\n<li>build.gradle에 plugin 추가 후</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">plugins <span class=\"token punctuation\">{</span>\n  id <span class=\"token string\">\"org.sonarqube\"</span> version <span class=\"token string\">\"3.0\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>scanner 를 실행하면</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./gradlew sonarqube \\\n  -Dsonar.projectKey=Test-Proj \\\n  -Dsonar.host.url=http://HOST:10002 \\\n  -Dsonar.login=***********************</code></pre></div>\n<ul>\n<li>정적분석 결과가 표시된다.</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/3adf418ed240c4d33879ddf364d05ad9/951a4/002-07.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABJ0AAASdAHeZh94AAABx0lEQVQoz31Ty04VQRTsHWHFji2foN+BS/22G90RN6xQghu3+gvGGF0AAtHkytyZfk0/pmeKOn3nEi8QOql0ZnpOddWpM6q3GUknTB5AIDK3EBBjxDRNmMYR41iIEUM0iH0D71ueB+4e2hh01qEzDjkPUB9/neHtt3dYfF9g8WOBo59HuP5zhW7V8iOL5Uqj5ceGhcZaWBavYes7rfV85uq5evXlEDsnO1DHCuq9wu7JLn4317CmR0yxKhV1OdNJSk+i73sEq+GsgXr99Q32Puzh4NMB9k/38fLzCyx9gxALLY9YrwnPraEUlKDhhfBmdYPz23Nc3F7U/bK5pLJEZYmq0rqPGwj1/88zijjQFo4tUr2jXBe2kFKmwoRSynbhMFT7DwlrYAzISQ9rY42+hyECFfrA/jFt6R1mZYmWZAIGEm/ejbxUHI2dhSeXsjU5O6e23iMVdj48UtP6SOVxm5B9lmDa2MK4h4Sy85ZEVS7kSrhZrIUNqV5Wyngfk5DKBSaZJwjnWcspcPZaXP3jKPSxDrfx/czg4NwSfxtb0xW7nfX1SAZ9i9CyR2Jb/gKB2BNI2lKYqWTIDC26Glqc51D6mge6cg53zCZBBRk58cUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"002 07\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/3adf418ed240c4d33879ddf364d05ad9/d9199/002-07.png\"\n        srcset=\"/devHistoryBlog/static/3adf418ed240c4d33879ddf364d05ad9/8ff5a/002-07.png 240w,\n/devHistoryBlog/static/3adf418ed240c4d33879ddf364d05ad9/e85cb/002-07.png 480w,\n/devHistoryBlog/static/3adf418ed240c4d33879ddf364d05ad9/d9199/002-07.png 960w,\n/devHistoryBlog/static/3adf418ed240c4d33879ddf364d05ad9/951a4/002-07.png 1355w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<br>\n<p><span class=\"title__sub1\">Pipeline 작성</span>\n<span class=\"title__sub2\">1. Test Stage</span></p>\n<ul>\n<li>테스트 코드를 수행한다.</li>\n<li>테스트 실패 시 테스트 결과 게시 및 PR comment &#x26; decline api 전송 후 파이프라인을 종료한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">stage ('Test') {\n    sh '''\n    {\n        ./gradlew test \\\n        &amp;&amp; curl -X POST -u \"$USER\" $COMMENT_URL -d '{\"content\": {\"raw\": \"[TEST] SUCCESS\"}}' -H 'Content-Type: application/json' > /dev/null 2>&amp;1 \\\n        &amp;&amp; echo [TEST] SUCCESS;\n    }||\\\n    {\n        ssh -ir ~/.ssh/v2g_srv $V2G_DEV_SERVER bash -c \"'mkdir -p /docker-volumes/nginx/html/failed-test/$SOURCE_BRANCH'\";\n        scp -ir ~/.ssh/v2g_srv ./build/reports/tests/test $V2G_DEV_SERVER:/docker-volumes/nginx/html/failed-test/$SOURCE_BRANCH;\n        curl -X POST -u \"$USER\" $COMMENT_URL -d '{\"content\": {\"raw\": \"[TEST] FAIL\"}}' -H 'Content-Type: application/json' > /dev/null 2>&amp;1;\n        curl -X POST -u \"$USER\" $DECLINE_URL -d '{\"content\": {\"raw\": \"[TEST] FAIL\"}}' -H 'Content-Type: application/json' > /dev/null 2>&amp;1;\n        echo [TEST] FAIL;\n        exit 1;\n    }\n    '''\n}</code></pre></div>\n<br>\n<p><span class=\"title__sub2\">2. Jacoco &#x26; SonarQube Analysis &#x26; Quality Gate</span></p>\n<ul>\n<li>테스트 성공 시 coverage 측정 및 정적분석 진행 후 Quality Gate 결과 확인</li>\n<li>Qulicy Gate 실패 시 PR comment &#x26; decline api 전송 후 파이프라인을 종료한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">stage ('Jacoco &amp; SonarQube Analysis &amp; Quality Gate') {\n    withSonarQubeEnv('sonarqube') {\n        sh \"./gradlew jacocoTestReport sonarqube\"\n    }\n    \n    def qg = waitForQualityGate()\n    if (qg.status != 'OK') {\n        sh '''\n            curl -X POST -u \"$USER\" $COMMENT_URL -d '{\"content\": {\"raw\": \"[QualityGate] FAIL\"}}' -H 'Content-Type: application/json' > /dev/null 2>&amp;1;\n            curl -X POST -u \"$USER\" $DECLINE_URL -d '{\"content\": {\"raw\": \"[QualityGate] FAIL\"}}' -H 'Content-Type: application/json' > /dev/null 2>&amp;1;\n            echo [TEST] FAIL;\n            exit 1;\n        '''\n    } else {\n        sh '''\n            curl -X POST -u \"$USER\" $COMMENT_URL -d '{\"content\": {\"raw\": \"[QualityGate] SUCCESS\"}}' -H 'Content-Type: application/json' > /dev/null 2>&amp;1;\n        '''\n    }\n}</code></pre></div>\n<br>\n<p><span class=\"title__sub2\">3. Approve PullRequest</span></p>\n<ul>\n<li>해당 PR에 대한 승인 API 전송 후 파이프라인 종료</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">stage ('Approve PR') {\n    timeout(time: 1, unit: 'MINUTES') {\n        sh '''\n            curl -X POST -u \"$USER\" $APPROVE_URL;\n            echo Approve PullRequest;\n        '''\n    }\n}</code></pre></div>\n<hr>\n<p><a href=\"https://eunyoung-autocrypt.github.io/devHistoryBlog/works/posts/2021-01-18--001\">> [작업로그] CI/CD 구축 #1 - CI/CD 시나리오</a><br>\n<a href=\"https://eunyoung-autocrypt.github.io/devHistoryBlog/works/posts/2021-01-18--002\">> [작업로그] CI/CD 구축 #2 - Docker, Docker Compose 설치</a><br>\n<a href=\"https://eunyoung-autocrypt.github.io/devHistoryBlog/works/posts/2021-01-18--003\">> [작업로그] CI/CD 구축 #3 - BitBucket 설정 및 Jenkins 설치</a><br>\n<a href=\"https://eunyoung-autocrypt.github.io/devHistoryBlog/works/posts/2021-01-21--001\">> [작업로그] CI/CD 구축 #4 - Jenkins Item 등록 및 Pipeline 작성</a>  </p>","fields":{"tagSlugs":["/tags/ci-cd/","/tags/sonarqube/","/tags/pipeline/"],"slug":"/works/posts/2021-01-23--002"},"frontmatter":{"title":"[작업로그] CI/CD 구축 #5","tags":["ci/cd","sonarqube","pipeline"],"date":"2021-01-23","description":"sonarqube 설치 및 pipeline 작성"}}},"pageContext":{"slug":"/works/posts/2021-01-23--002"}},"staticQueryHashes":[]}