{"componentChunkName":"component---src-templates-post-template-jsx","path":"/works/posts/2020-10-20--001","result":{"data":{"site":{"siteMetadata":{"title":"Blog by Eunyoung","subtitle":"일상 & 작업 기록 블로그","copyright":"© All rights reserved.","author":{"name":"EunYoung","twitter":"#"},"disqusShortname":"","url":"https://eunyoung-autocrypt.github.io"}},"markdownRemark":{"id":"7ab61726-2b83-5b9c-a44f-fc54dde8e28b","html":"<h3>의문사항</h3>\n<ul>\n<li>같은 Session 에서 중복 로그인이 가능하다.</li>\n<li>같은 Session 에서 중복 로그인 시 session id가 변경된다.</li>\n<li>로그아웃 후에 다시 로그인을 하면 ‘이미 접속된 아이디’ 오류가 난다.</li>\n<li>session 사용시 cookie 에 저장되는 JSESSIONID 에 대한 보안 이슈가 없는가</li>\n</ul>\n<h4>1. session 설정 내용</h4>\n<ul>\n<li>maximumSessions : 최대 세션 개수</li>\n<li>maxSessionsPreventsLogin : 기존에 접속한 사용자가 있을 경우 기존 사용자의 접속을 끊고, 나중에 접속한 사용자가 접속되도록 한다.(default: false)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@EnableWebSecurity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n      <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSessions</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">maxSessionsPreventsLogin</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">sessionRegistry</span><span class=\"token punctuation\">(</span><span class=\"token function\">sessionRegistry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>2. DEBUG</h4>\n<p>chrome 에서 admin 계정으로 로그인 후(SessionId를 부여 받음) 새탭에서 다시 admin 계정으로 로그인을 하면 </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/e71d8d22b54e9a89669134ce90d302ed/d0fa6/001-01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 69.58333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABJ0AAASdAHeZh94AAABsklEQVQ4y4WTTXLbMAyFfZ1IBEESkmhZlu100V0bZ3r/s6D4oRTHyUwW34DCUOAjHnhYX698PR+Fyr+us/F6O/NpOfF8vvC8rFznkzEdNS5cT0vLLZ+R/IHGyojIAxWu9chTrTxOlQeBaJT8yKUQp5w5RhQigxDlHwWNxJiSfR8yTQwQrKAWGcbJyFKAaOAiMWPkAMAhBO773rC1EB7Q/KEME0fZTKUwDa5GFWZVlbKc7IDsASvqQDtA1W55gOgFNVlSbPKxXS/6D62Qnt513Ree865Qfk4JTRG0Qs+bt6v+hCsUqRnB1G3KupeXbxX9qJCkoLtM1recWy/J11mUq4PWTzsQd7c1biIspy77lcUUKUCDuprMYR0F3YgyAbH1EZ5c3Xrs0dfNFLQiNpwyvIPMZhGVKRNjJotJ1IMcEmRvAJSRiYIUA49dHwwvOP9mXP8y3e6Mt387SYiXdw7rG8PlbusoEda7fXvuzuH8xv3yx/Ary8l6ujkMTg8fCvacKfmM5YJHZR8bmz9rvqN99d5ts6gvoTn7SN99M4f7W0xuRnNTX0gENSZZ3Meksc3e4/o/ZNG09tzUql8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 01\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/e71d8d22b54e9a89669134ce90d302ed/d9199/001-01.png\"\n        srcset=\"/devHistoryBlog/static/e71d8d22b54e9a89669134ce90d302ed/8ff5a/001-01.png 240w,\n/devHistoryBlog/static/e71d8d22b54e9a89669134ce90d302ed/e85cb/001-01.png 480w,\n/devHistoryBlog/static/e71d8d22b54e9a89669134ce90d302ed/d9199/001-01.png 960w,\n/devHistoryBlog/static/e71d8d22b54e9a89669134ce90d302ed/d0fa6/001-01.png 1263w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>동일한 SessionId 에서 로그인 시도를 했기 때문에<br>\nConcurrentSessionControlAuthenticationStrategy.onAuthentication() 에서\n123라인의 allowableSessionsExceeded() 메소드(중복로그인 exception)를 호출하지 않고 종료가 된다.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/c697d99ae775c93e05f8c47ffa869909/d4c13/001-02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 825px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABJ0AAASdAHeZh94AAABa0lEQVQoz41SS5aDMAzjOAXy/0KgpV30/kfS2KbttGUxs9CLE4gsyenO9ztutwtu1xXbtuC67et2Wej8jNYqyjSjzguh/Yku5gnOR2itYYyFtQ5KKQzDgHEcBVz/F13IFYZIjDHw3gtCCAKurbXyjdf3mpv2ff8iejYXhUxonUOtZK9U5Fxk3eu8kwf/0TDGKDU3YHdPJ12qbNnDGS3wViN6g+BZsaXL+0VHDZ+EL6VmV/1FWIXQG4WSAqYSscyF1oBaEnKZdlTGjESqA6lju31/Otgmy5XsBmg1IsWAVjOmthLOmJczpnnF9bJhW1c4rciBIweJ3Dg460XdIUMhHAdMXqNRg7nSc1mJcF0EOUVSFlFalljUqEmAgdH28Ao6tuIchUtZ1FZkCJlIM0URcyQksRjpfCLyfUBBMlXkihW+o0uZMwwyZU8qbHDyM++5keDr+cgQH8M4EIa0Z8jS+1P/CPuIX1vf+0/8ABpyWReJSKsLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 02\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/c697d99ae775c93e05f8c47ffa869909/d4c13/001-02.png\"\n        srcset=\"/devHistoryBlog/static/c697d99ae775c93e05f8c47ffa869909/8ff5a/001-02.png 240w,\n/devHistoryBlog/static/c697d99ae775c93e05f8c47ffa869909/e85cb/001-02.png 480w,\n/devHistoryBlog/static/c697d99ae775c93e05f8c47ffa869909/d4c13/001-02.png 825w\"\n        sizes=\"(max-width: 825px) 100vw, 825px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>CompositeSessionAuthenticationStrategy.onAuthentication() 에서\nfixation 기본값 인 migrateSession에 의해 AbstractSessionFixationProtectionStrategy 가 delegate 된다. (89라인)</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/fc4dfbbf00d74e99288cdb4ddde139d5/d8817/001-03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 64.58333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABJ0AAASdAHeZh94AAABzklEQVQ4y32S6W7bMBCE/TateZPLQ7Ijp2hc2U5aBEiP93+T6ZKUDblN++PDkpQw2NnZzdPlGfNpxpfjZ1zOM14uM07nE/bTAePuAbv9hGEYkXNZGFAK38twRyn9fRNiQdAGSUmMMWNgsicMIWFHic8BxfbvpBSC0oyCFwJ+u+3czgIbSgXGWnhnQEQIgeCc47uHsx7G2PZdaQ3FQlJKCBZYs35rHRrrYLgDJcU7PzPr+yLwL26Cjq0F7tDXGnqnxhhItqh4JB3ulO/rrq5C1/MmLJarTeL5UYzwoQvXSsEjkUOwCuR4dlxls147ln8L1hlqnlOgiGHccWJjE7N1hlWUZ+utbEK1WsMdSnUndme5C5rWwZiJ14K7ZPGUEiL1gGowVouGN4z+AC0/YsvJiopYKrOpFm35BPv4hnj8ifj0A+n4i+t32Okb9PQKPz0jHmZkJh1OCI9fEaYz3EPHL9Qzd5hhfIKlAT7t4dIOPu9h4wgTCqTL0I4aqhHbW61meTeebv/0PWTLltcmstVAdoGDiGyX59ZRrSoloNWWExftLOWflpdQ6jrUtK/Uua6rrHt6XewV7+xhbgnXEBIH0ki535dag6rhiP8s9fXbbzN8l82TvjaEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 03\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/fc4dfbbf00d74e99288cdb4ddde139d5/d9199/001-03.png\"\n        srcset=\"/devHistoryBlog/static/fc4dfbbf00d74e99288cdb4ddde139d5/8ff5a/001-03.png 240w,\n/devHistoryBlog/static/fc4dfbbf00d74e99288cdb4ddde139d5/e85cb/001-03.png 480w,\n/devHistoryBlog/static/fc4dfbbf00d74e99288cdb4ddde139d5/d9199/001-03.png 960w,\n/devHistoryBlog/static/fc4dfbbf00d74e99288cdb4ddde139d5/d8817/001-03.png 1238w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>AbstractSessionFixationProtectionStrategy.onAuthentication() 에서\nSession Fixation Attack 방지로 인해 NewSessionId가 생성된다.<br>\n즉, 동일 로그인ID ‘admin’ 으로 SessionId, NewSessionId 각 2개가 생성되었다.  </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/7a9a20ac71cd934e3e0e3ffefb6b4d9c/8d7b0/001-04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 27.083333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABJ0AAASdAHeZh94AAAA6klEQVQY042O2U7DMBBF/f+/BOoitUn7QkVbtgacVCKbsxlinIU4l4kRok8IS0eWzvXcMQvDEGmWIktjNHWJsVcY2hqNkvY2nYJ+L9AQdZXirUgg8xitqtBriZZmelVCy8zOsyiKEEevOHghFscS6ycF97nF7FbgehdjccjgPEo4nsbyrrJ+ts8xJ5b3kpzE/ChxtRM2Y0mSoMgFHvyUijQ2Lx1cwjkpbDyFm3Nn2fLelrrkXO/Dvp0Wb3mH9UljNX2EMhYEATjnkGWO/53xDwDm+74tFEJgJDeY8ZvBwJAw5pcff8nnBVP+Bd7JeGPKEWZYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 04\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/7a9a20ac71cd934e3e0e3ffefb6b4d9c/d9199/001-04.png\"\n        srcset=\"/devHistoryBlog/static/7a9a20ac71cd934e3e0e3ffefb6b4d9c/8ff5a/001-04.png 240w,\n/devHistoryBlog/static/7a9a20ac71cd934e3e0e3ffefb6b4d9c/e85cb/001-04.png 480w,\n/devHistoryBlog/static/7a9a20ac71cd934e3e0e3ffefb6b4d9c/d9199/001-04.png 960w,\n/devHistoryBlog/static/7a9a20ac71cd934e3e0e3ffefb6b4d9c/07a9c/001-04.png 1440w,\n/devHistoryBlog/static/7a9a20ac71cd934e3e0e3ffefb6b4d9c/8d7b0/001-04.png 1723w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>탬 1, 탭2 의 브라우저 cookie 에는 마지막으로 생성된 NewSessionId가 부여되며, 기존 SessionId를 해제를 하지 못한 상태로 Client 에서 사라지게 된다.<br>\n즉, NewSessionId로 로그아웃을 하더라도 ‘admin’ 계정에 대한 SessionId가 존재하므로 재 로그인 시 중복된 로그인 에러가 뜨게 된다.</p>\n<h4>3. 해결방안 : sessionFixation - none</h4>\n<ul>\n<li>Session Fixation Attack 방지<br>\n악의적인 사용자가 사이트에 접근하기 위한 세션을 만들고, 그 세션을 통해 다른 사용자로 로그인 하려고 하는 경우(예를 들어, 세션에 ID를 파라미터로 포함하여 전송하는 경우)\nSession fixation attack의 잠재적인 위험이 존재하게 된다.<br>\n스프링 시큐리티는 이러한 공격을 자동으로 막기 위하여 사용자 로그인 때마다 새로운 세션을 생성한다.<br>\n이러한 방지 기능이 필요하지 않거나, 다른 기능들과 충돌이 발생할 경우에는, <session-management>의 session-fixation-protection 속성값으로 동작을 제어할 수 있다.<br>\n속성은 다음과 같은 세가지 옵션값들을 가진다.  </li>\n<li>동일 세션에서 로그인이 재발생해도 동일한 session id를 갖도록 한다.</li>\n<li>동일 세션에서 중복 로그인 후 로그아웃하면 해당 로그인 id에 대한 세션이 해제가 되어 재 로그인이 가능하다.</li>\n<li>none 으로 설정 시 호출되는 Session Strategy Class</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/devHistoryBlog/static/2615a5eb6d37fb817a32f1a0a35d9071/8efc2/001-05.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 828px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 55.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABJ0AAASdAHeZh94AAABPUlEQVQoz5VS2W7DMAzL7+TwLflIlx4btv//I05RWqBFUgx7ICzbAk2Z7JbvH9y+bvj6vOB6XbAsM86Cy/mEWhlc6hs05LpHlyjDJ0ajAA4OPiZE2SfOCFKHEDfoOcFrHWGtRd/3GIbhBV3iIiQE9iOStzDSOI4jpmnSdZR1esJjr3cHUMIgiqyzu9f+wiFhXEcWhTZYOBKFzigmIyqGrWlPJmdKsNU7hT7I35BDOnkhW8cc7s39WyWPh/YjU1EjKBjk6FGSmJMiSvsQ12ZkcXM142EKyYPsekxKeDAy1QrKBVZGJHGZhbDlhJqFlCOIWJ11zsN5r7V17u2/dpSz5ireyUpmzK2gFUYVZLmvbUaRjJW2Kq4oojpRlESYlwSs6EjzRojasMXGmGeYPaTH2uM7dTnI36zs/43NEX4BC+BVRc7QkV4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"001 05\"\n        title=\"\"\n        src=\"/devHistoryBlog/static/2615a5eb6d37fb817a32f1a0a35d9071/8efc2/001-05.png\"\n        srcset=\"/devHistoryBlog/static/2615a5eb6d37fb817a32f1a0a35d9071/8ff5a/001-05.png 240w,\n/devHistoryBlog/static/2615a5eb6d37fb817a32f1a0a35d9071/e85cb/001-05.png 480w,\n/devHistoryBlog/static/2615a5eb6d37fb817a32f1a0a35d9071/8efc2/001-05.png 828w\"\n        sizes=\"(max-width: 828px) 100vw, 828px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n     </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// migrateSession : 새로운 세션을 생성하고 기존의 세션 값들을 새 세션에 복사해준다. 기본값으로 설정되어 있다.</span>\n<span class=\"token comment\">// none : 아무것도 수행하지 않는다. 원래의 세션이 유지된다.</span>\n<span class=\"token comment\">// newSession : \"깨끗한\" 새로운 세션을 생성한다. 기존의 세션데이터는 복사하지 않는다.</span>\n\nhttp<span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">sessionFixation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">none</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSessions</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">maxSessionsPreventsLogin</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">sessionRegistry</span><span class=\"token punctuation\">(</span><span class=\"token function\">sessionRegistry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>4. JSESSIONID 는 안전한가?</h4>\n<ul>\n<li>기본적으로 HttpOnly 를 사용   </li>\n<li>HttpOnly는 Set-Cookie HTTP 응답 헤더에 포함 된 추가 플래그   </li>\n<li>쿠키를 생성 할 때 HttpOnly 플래그를 사용하면 보호 된 쿠키에 액세스하는 클라이언트 측 스크립트의 위험을 완화하는 데 도움이됩니다</li>\n<li>XSS ( 교차 사이트 스크립팅 ) 결함이 존재하고 사용자가이 결함을 악용하는 링크에 실수로 액세스하더라도 브라우저 (주로 Internet Explorer)는 쿠키를 제 3 자에게 공개하지 않는다.</li>\n</ul>","fields":{"tagSlugs":["/tags/spring-security/"],"slug":"/works/posts/2020-10-20--001"},"frontmatter":{"title":"[작업로그] 이중로그인 방지 (Spring Security)","tags":["SpringSecurity"],"date":"2020-10-20","description":""}}},"pageContext":{"slug":"/works/posts/2020-10-20--001"}},"staticQueryHashes":[]}